%!TEX root = stability_manifold_TSP.tex

Consider a compact, smooth and differentiable $d$-dimensional submanifold $\ccalM \subset \reals^N$. For simplicity, in this paper we use the words submanifold and manifold interchangeably, assuming the manifold $\ccalM$ to always be embedded in $\reals^N$. This embedding induces a Riemannian structure \cite{gallier2020differential}.
In turn, the Riemannian structure allows defining a measure $\mu$ over the manifold as well as a notion of \emph{length} for smooth curves on $\ccalM$. Given two points $x, y\in\ccalM$, the length of the shortest curve between $x$ and $y$ is denoted $\text{dist(x,y)}$ and called the geodesic distance between these points.

We consider the manifold $\ccalM$ to be the support of data that we represent as smooth real scalar functions $f:\ccalM\rightarrow \reals$. We call these scalar functions \emph{manifold signals}. We focus on manifold signals that have finite energy, such that $f \in L^2(\ccalM)$. Since  $L^2(\ccalM)$ is a Hilbert space, it is equipped with an inner product given by
\begin{equation}\label{eqn:innerproduct}
    \langle f,g \rangle_{L^2(\ccalM)}=\int_\ccalM f(x)g(x) \text{d}\mu(x) 
\end{equation}
where $\text{d}\mu(x)$ is the $d$-dimensional volume element corresponding to measure $\mu$. Thus, the energy of the signal $f$ is given by $\|f\|^2_{L^2(\ccalM)}={\langle f,f \rangle_{L^2(\ccalM)}}$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Laplace-Beltrami Operator}\label{sec_lb}

On manifolds, differentiation is implemented by the \emph{intrinsic gradient} -- a local operator acting on a neighborhood of each point $x \in \ccalM$ that is homeomorphic to a $d$-dimensional Euclidean space. This neighborhood contains all the vectors tangent to $\ccalM$ at $x$, which is called the tangent space of $x \in \ccalM$ and is denoted as $T_x\ccalM$. The disjoint union of all tangent spaces on $\ccalM$ is the tangent bundle $T\ccalM$. Formally, the intrinsic gradient is the operator $\nabla: L^2(\ccalM)\rightarrow L^2(T\ccalM)$ mapping scalar functions $f(x) \in L^2(\ccalM)$ to \textit{tangent vector functions} $\nabla f(x) \in L^2(T_x\ccalM)$. The tangent vector function $\nabla f(x)$ indicates the direction of the fastest change of signal $f$ at point $x$. The adjoint of the intrinsic gradient is the \emph{intrinsic divergence}, defined as $\text{div}: L^2(T\ccalM)\rightarrow L^2(\ccalM)$. Interpreting the tangent vector field as the velocity field of a fluid, the intrinsic divergence can be seen as a measure of the net motion of the fluid at each point \cite{bronstein2017geometric}. 

The Laplace-Beltrami (LB) operator of a manifold $\ccalM$ is defined as the operator $\ccalL: L^2(\ccalM) \to L^2(\ccalM)$ given by the function composition of the intrinsic divergence and the intrinsic gradient. When considered in the local coordinates supported on $T_x\ccalM$ \cite{canzani2013analysis}, the LB operator can be written as 
\begin{equation}\label{eqn:Laplacian}
    \ccalL f=-\text{div}\circ \nabla f=-\nabla \cdot \nabla f.
\end{equation}
Much like the Laplace operator in Euclidean domains (or the Laplacian matrix, in the case of graphs\cite{moon2012field}), the LB operator measures the total variation of function $f$, i.e., how much the value of $f$ at a point deviates from local average of the values of $f$ in its surroundings \cite{bronstein2017geometric}. Since $\ccalL$, like $\nabla$, is a local operator depending on the tangent space $T_x\ccalM$ of each point $x \in \ccalM$, in the following we make this dependence explicit by writing $\ccalL=\ccalL_x$ and $\nabla=\nabla_x$.
%To stress the fact that the intrinsic gradient and the LB operator are local, and to specify 
%for the local effects of $\nabla$ and $\ccalL$ at each $x \in \ccalM$, in the following we will $\ccalL=\ccalL_x$ and $\nabla=\nabla_x$. 

The LB operator plays an important role in partial differential equations (PDEs), as it governs the dynamics of the diffusion of heat over manifolds as given by the \emph{heat equation}
%
\begin{equation}\label{eqn:heat}
    \frac{\partial u(x,t)}{\partial t}+\ccalL u(x,t)=0 \text{.}
\end{equation}
%
If $u(x,t)\in L^2(\ccalM)$ measures the temperature of point $x \in \ccalM$ at time $t \in \reals^{+}$, equation \eqref{eqn:heat} can be interpreted to mean that, at point $x$, the rate at which the manifold ``cools down'' is proportional to the difference between the temperature of $x$ and the local average of the temperature of the points in its neighborhood. With initial condition $u(x,0) = f(x)$, the solution to this equation is given by
\begin{equation}\label{eqn:heat-solution}
    u(x,t) = e^{-t \ccalL}f(x) \text{,}
\end{equation}
which is the key support to implement the LB operator in the definitions proposed later.

The LB operator $\ccalL$ is self-adjoint and positive-semidefinite. Considering that $\ccalM$ is compact, the LB operator $\ccalL$ has a real positive eigenvalue spectrum $\{\lambda_i\}_{i=1}^\infty$ satisfying
\begin{equation}\label{eqn:laplacian-decomp}
\ccalL \bm\phi_i =\lambda_i \bm\phi_i
\end{equation}
where $\bm\phi_i$ is the eigenfunction associated with eigenvalue $\lambda_i$. The indices $i$ are such that the eigenvalues are ordered in increasing order as $0<\lambda_1\leq \lambda_2\leq \lambda_3\leq \hdots$. In particular, for a $d$-dimensional manifold, we have that $\lambda_i \propto i^{2/d}$ as a consequence of Weyl's law \cite{arendt2009weyl}. The eigenfunctions $\bm\phi_i$ are orthonormal and form a generalized eigenbasis of $L^2(\ccalM)$ in the intrinsic sense. Since $\ccalL$ is a total variation operator, the eigenvalues $\lambda_i$ can be interpreted as the canonical frequencies and the eigenfunctions $\bm\phi_i$ as the canonical oscillation modes of $\ccalM$. This further allows us to implement operator $\ccalL$ in the spectral domain.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Manifold Filters}\label{sec_manifold_filters}
Time signals are processed by filters which compute the continuous time convolution of the input signal and the filter impulse response \cite{oppenheim1997signals};
images and high-dimensional Euclidean signals are processed by filters implementing multidimensional convolutions \cite{bishop2006pattern}; and graph signals are filtered by computing graph convolutions \cite{gama2020graphs}. In this paper, we define a manifold filter as the convolution of the filter impulse response $\tdh(t)$ and the manifold signal $f$. Note that the definition of the convolution operation, denoted as $\star_\ccalM$, leverages the heat diffusion dynamics described in \eqref{eqn:heat-solution}. 
%The manifold filter is then defined as the convolution of the filter impulse response $\tdh$ and the manifold signal $f$ as formalized in Definition \ref{def:manifold-convolution}.

%We introduce a definition of manifold convolution operation by leveraging the process of heat diffusion over the manifold. Based on the notions of continuous-time convolution in signal processing \cite{oppenheim1997signals} and graph convolutions \cite{gama2020graphs}, manifold signals $f\in L^2(\ccalM)$ can be processed with filter function $\tdh(t): \reals^+ \rightarrow \reals$ as the following definition shows.
%An integration operation can map the filter function into the endomorphism of $L^2(\ccalM)$ \cite{parada2021algebraic}. Therefore we can write the manifold convolution operation of $\tdh(t)$ and $u(x, t)$ as


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[Manifold filter]
\label{def:manifold-convolution}
Let $\tdh(t):\reals^+ \to \reals$ and let $f \in L^2(\ccalM)$ be a manifold signal. The manifold filter with impulse response $\tdh(t)$, denoted as $\bbh$, is given by
%
\begin{align} \label{eqn:convolution-conti}
   g(x) = (\bbh f)(x) := (\tdh \star_\ccalM f) (x) := \int_0^\infty \tdh(t)u(x,t)\text{d}t 
\end{align}
%
where $\tdh \star_\ccalM f$ is the \emph{manifold convolution} of $\tdh$ and $f$, and $u(x,t)$ is the solution of the heat equation \eqref{eqn:heat} with initial condition $u(x,0)=f(x)$. 
\end{definition}

In a slight abuse of nomenclature, in the following we will use the terms manifold filter and manifold convolution interchangeably.

From Definition \ref{def:manifold-convolution}, we see that the manifold filter operates on manifold signals $f(x)$ by (i) scaling the diffusion process \eqref{eqn:heat-solution} starting at $f(x)$ by $\tdh(t)$ and (ii) aggregating the outcome of the scaled diffusion process from $t=0$ to $t=\infty$. This definition is somewhat contrived because it does not allow computing the output of the filter directly from $f$. To be able to do so, we need to substitute the solution of the heat equation \eqref{eqn:heat-solution} for $u(x,t)$ in \eqref{eqn:convolution-conti}. This leads to a closed-form expression of $\bbh$ that is parametric on the LB operator as shown in Proposition \ref{prop:manifold-filter}.
%Similar to the continuous time convolution operation, we can interpret the manifold convolution as the integral of the filter function scaled with the temperature over the manifold at this time step. By inserting the solution of heat equation given in \eqref{eqn:wave-solution} into our definition of convolution, we can derive the manifold convolution filters as follows.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% PROPOSITION %%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proposition}
\label{prop:manifold-filter}
The manifold filter $\bbh$ is a parametric map $\bbh(\ccalL)$ of the LB operator $\ccalL$, which is shown as
%Manifold convolution filter along time $t\in\reals^+$ with manifold convolutional function $\tdh(t)$ over the manifold with LB operator $\ccalL$ can be defined as
\begin{equation} \label{eqn:manifold-conv-spatial}
   g(x) = (\bbh f)(x) =\int_0^\infty \tdh(t)e^{-t\ccalL}f(x)\text{d}t =  \bbh(\ccalL)f(x) \text{.}
\end{equation}
%when applied to manifold signal $f\in L^2(\ccalM)$.
\end{proposition}

Proposition \ref{prop:manifold-filter} tells us that manifold filters are spatial operators, since they operate directly on points $x \in \ccalM$; moreover, it tells us that they are local, because they are parametrized by $\ccalL$ which is itself a local operator. The exponential term $e^{-t\ccalL}$ can be seen as a diffusion or shift operation akin to a time delay in a linear time-invariant (LTI) filter \cite{oppenheim1997signals}, or as the graph shift operator in a linear shift-invariant (LSI) graph filter \cite{gama2020graphs}. Indeed, if we consider the manifold $\ccalM$ to be the real line, the manifold filter defined in \eqref{eqn:manifold-conv-spatial} recovers a LTI filter. If we consider it to be a set of points connected by a geometric graph, \eqref{eqn:manifold-conv-spatial} recovers a LSI graph filter. We discuss these special cases in further detail in Appendix \ref{app:rem_convolution} and Section \ref{sec:discre_nn}.

%In the spatial domain, the manifold convolution is defined as an integral of a set of weighted manifold signals with the weights characterizing both convolutional function and the heat effect caused by the neighborhood of point $x\in\ccalM$. The operator $e^{-t\ccalL}$ can be understood as a similarity metric under heat diffusion among the points on the manifold. The similarity actually characterizes the amount of heat received at point $x$ from its neighborhood during the time period $t$. 
%This manifold convolution operation can also be understood through the lens of graph shifting operations with LB operator behaving similarly to the graph Laplacians, which we will demonstrate in Section \ref{sec:discre_nn} in detail.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Frequency Representation of Manifold Filters}\label{sec_spectral_representation}

A manifold signal $f\in L^2(\ccalM)$ can be represented in the frequency domain of the manifold by projecting $f$ onto the LB operator eigenbasis \eqref{eqn:laplacian-decomp} as
%
\begin{equation}\label{eqn:f-decomp}
[\hat{f}]_i= \langle f, \bm\phi_i \rangle_{L^2(\ccalM)} = \int_\ccalM f(x) \bm\phi_i(x) \text{d} \mu(x) \text{,}
\end{equation} 
where we claim that $\hat{f}$ is the \textit{frequency representation} of the corresponding signal with $f=\sum_{i=1}^\infty [\hat{f}]_i \bm\phi_i$.

Frequency representations are useful because they help understand the frequency behavior of the manifold filter $\bbh(\ccalL)$. To see this, we consider the frequency representation of the manifold filter output $g$ in \eqref{eqn:manifold-conv-spatial}, which is
\begin{equation}
    [\hat{g}]_i = \int_\ccalM \int_0^\infty \tdh(t) e^{-t\ccalL} f(x) \text{d} t \bm\phi_i(x) \text{d} \mu(x) \text{.}
\end{equation}
Rearranging the integrals and substituting $e^{-t\ccalL}\phi_i = e^{-t\lambda_i}\phi_i$, we can get
\begin{equation}\label{eqn:projection}
    [\hat{g}]_i = \int_0^\infty \tdh(t) e^{-t\lambda_i} \text{d}t  [\hat{f}]_i \text{.}
\end{equation}
%which relates the frequency representation of the filter output $g$ to the frequency representation of the input $f$. 
The expression relating $\hat{g}$ and $\hat{f}$ is called the \emph{frequency response} of the filter $\bbh(\ccalL)$. 
%This is formalized in Definition \ref{def:frequency-response}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[Frequency response]
\label{def:frequency-response}
The frequency response of the filter $\bbh(\ccalL)$ is given by
\begin{equation}\label{eqn:operator-frequency}
\hat{h}(\lambda)=\int_0^\infty \tdh(t) e^{- t \lambda  }\text{d}t \text{.}
\end{equation}
\end{definition}

An important consequence of Definition \ref{def:frequency-response} is that, since $\hat{h}(\lambda)$ is parametric on $\lambda$, the manifold filter is pointwise in the frequency domain. This can be seen by plugging \eqref{eqn:operator-frequency} into \eqref{eqn:projection}, and is stated explicitly in Proposition \ref{prop:filter-spectral}.

%By plugging the projection on each eigenfunction \eqref{eqn:projection} into \eqref{eqn:f-decomp}, we can represent the output of manifold filter $\bbh(\ccalL)$ in the spectral domain. This leads to the proposition of the manifold filter from the spectral perspective.

%
% Plugging \eqref{eqn:laplacian-decomp} into \eqref{eqn:f-decomp}, we can then rewrite \eqref{eqn:Laplacian} as
% %
% \begin{equation} \label{eqn:Laplacian-spectrum}
%     \ccalL f=\sum_{i=1}^\infty \lambda_i\langle f, \bm\phi_i \rangle_{L^2(\ccalM)} \bm\phi_i.
% \end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% PROPOSITION %%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proposition}
\label{prop:filter-spectral}
The manifold filter $\bbh(\ccalL)$ is pointwise in the frequency domain, which is written as
%\begin{equation}\label{eqn:convolution}
%\bbh(\ccalL) f:=\sum_{i=1}^\infty \int_0^\infty \tdh(t) e^{- t \lambda_i } \text{d}t \langle f,\bm\phi_i \rangle_{L^2(\ccalM)} \bm\phi_i.
%\end{equation}
%Taking the form of frequency response [cf. Definition \ref{def:frequency-response}] into consideration, we can further write the manifold filter $\bbh(\ccalL)$ as
\begin{equation}\label{eqn:convolution-general}
%\bbh(\ccalL) f:=\sum_{i=1}^\infty h(\lambda_i) \langle f,\bm\phi_i \rangle_{L^2(\ccalM)} \bm\phi_i.
[\hat{g}]_i = \hat{h}(\lambda_i)[\hat{f}]_i \text{.}
\end{equation}
\end{proposition}

Definition \ref{def:frequency-response} also emphasizes that the frequency response of a manifold filter is independent of the underlying manifold. Note that, in \eqref{eqn:operator-frequency}, $\hat{h}(\lambda)$ is a function of an arbitrary scalar variable $\lambda$. To obtain the frequency behavior of this filter on a given manifold $\ccalM$, we need to evaluate $\hat{h}$ at the corresponding LB operator eigenvalues $\lambda_i$ [cf. \eqref{eqn:laplacian-decomp}]. If the manifold changes (or if we want to deploy the same filter on a different manifold $\ccalM'$), it suffices to reevaluate $\hat{h}$ at $\lambda_i'$, i.e., at the eigenvalues of the new LB operator $\ccalL'$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Stability of Manifold Filters with respect to Manifold Deformations}\label{sec_manifold_stability}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\subsection{Manifold Deformations}
\input{manifold_perturbations}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Stability of Manifold Filters to Absolute Perturbations}
\label{subsec:filter-absolute}
We start by analyzing the stability of manifold filters to absolute perturbations of the LB operator, which are introduced in Definition \ref{def:abso-perturb}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[Absolute perturbations] \label{def:abso-perturb}
Let $\ccalL$ be the LB operator of manifold $\ccalM$. An absolute perturbation of $\ccalL$ is defined as
\begin{equation}\label{eqn:abso-perturb}
\ccalL'-\ccalL=\bbA,
\end{equation}
where the absolute perturbation operator $\bbA$ is self-adjoint.
\end{definition}

Like $\ccalL$, the operator $\ccalL'$ resulting from the absolute perturbation of $\ccalL$ is self-adjoint due to the symmetry of $\bbA$. Hence, it admits an eigendecomposition similar to \eqref{eqn:Laplacian}. When the filter coefficients are fixed, the frequency response of the manifold filter \eqref{eqn:convolution-general} can be obtained by evaluating $\hhath(\lambda)$ at each $\lambda_i$. Thus, to understand the effect of the perturbation on the filter we need to look at how the perturbation of the LB operator changes the eigenvalues $\lambda_i$. The challenge in this case is that the spectrum of $\ccalL$ is infinite-dimensional, i.e., there is an infinite (though countable) number of eigenvalue perturbations that need to be taken into account. 
As demonstrated by Proposition \ref{prop:finite_num}, however, large eigenvalues accumulate in certain parts of the real line. This suggests a strategy to partition the spectrum into finite number of partitions. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% PROPOSITION %%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{proposition} \label{prop:finite_num}
Consider a $d$-dimensional compact manifold $\ccalM\subset \reals^N$ and let $\ccalL$ be its LB operator with eigenvalues $\{\lambda_k\}_{k=1}^\infty$. Let $C_1$ be an arbitrary constant and $C_d$ the volume of the $d$-dimensional unit ball. Let $\text{Vol}(\ccalM)$ denote the volume of manifold $\ccalM$. For any $\alpha > 0$ and $d>2$, there exists $N_1$,
\begin{equation}
    N_1=\lceil (\alpha d/C_1)^{d/(2-d)}(C_d \text{Vol}(\ccalM))^{2/(2-d)} \rceil
\end{equation}
such that, for all $k>N_1$, 
$$\lambda_{k+1}-\lambda_k\leq \alpha.$$
\end{proposition}
\begin{proof}
This is a direct consequence of Weyl's law \cite[Chapter~1]{arendt2009mathematical}.
\end{proof}

%Proposition \ref{prop:finite_num} indicates a strategy to overcome the challenge of analyzing the effect of the perturbation on the infinite-dimensional spectrum of $\ccalL$. 
Given this asymptotic behavior, we can divide the eigenvalues into a finite number of partitions by placing eigenvalues that are less than $\alpha>0$ apart from each other in groups. This spectrum separation strategy is described in Definition \ref{def:alpha-spectrum}. To achieve it, we will need a specific type of manifold filter called Frequency Difference Threshold (FDT) filter as introduced in Definition \ref{def:alpha-filter}.
%Due to Proposition \ref{prop:finite_num}, the number of such groups is \emph{finite}. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}[$\alpha$-separated spectrum]\label{def:alpha-spectrum}
The $\alpha$-separated spectrum of a LB operator $\ccalL$ is defined as the partition $\Lambda_1(\alpha) \cup \ldots\cup \Lambda_N(\alpha)$ such that all $\lambda_i \in \Lambda_k(\alpha)$ and $\lambda_j \in \Lambda_l(\alpha)$, $k \neq l$, satisfy
\begin{align}\label{eqn:alpha-spectrum}
|\lambda_i - \lambda_j| > \alpha \text{.}
\end{align}
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}[$\alpha$-FDT filter]\label{def:alpha-filter}
The $\alpha$-frequency difference threshold ($\alpha$-FDT) filter is defined as a filter $\bbh(\ccalL)$ whose frequency response satisfies
\begin{equation} \label{eq:fdt-filter}
    |\hhath(\lambda_i)-\hhath(\lambda_j)|\leq \delta_k \mbox{ for all } \lambda_i, \lambda_j \in \Lambda_k(\alpha) 
\end{equation}
with $\delta_k\leq \delta$ for $k=1, \ldots,N$.
\end{definition}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% FIGURE %%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}
\centering
  \input{frequency_response_absolute.txt}    
  \caption{Illustration of an $\alpha$-FDT filter. The $x$-axis stands for the spectrum with each sample representing an eigenvalue. The gray shaded areas show the grouping of the eigenvalues according to Definition \ref{def:alpha-spectrum}. The red lines show a set of $\alpha$-FDT filters that can discriminate each eigenvalue group.}
\label{fig:alpha}
\end{figure}

In the $\alpha$-separated spectrum, eigenvalues $\lambda_i \in \Lambda_k(\alpha)$ and $\lambda_j \in \Lambda_l(\alpha)$ in different sets ($k \neq l$) are at least $\alpha$ away from each other. Conversely, eigenvalues $\lambda_i, \lambda_j \in \Lambda_k(\alpha)$ are no more than $\alpha$ apart. This partitioning creates several eigenvalue groups spaced by at least $\alpha$. Note that the sets $\Lambda_k(\alpha)$ can have any size and, in particular, they can be singletons.
%, i.e., it can be formed by a single eigenvalue.
%that is at least $\alpha$ away from all of its neighboring eigenvalues. 

The partitioning of the spectrum described in Definition \ref{def:alpha-spectrum} is achieved by an $\alpha$-FDT filter. This filter separates the spectrum of the manifold by {assigning similar frequency responses---that deviate no more than $\delta_k$ from each other---to eigenvalues $\lambda_i \in \Lambda_k(\alpha)$, $1 \leq k \leq N$. In other words, the $\alpha$-FDT filter does not discriminate between eigenvalues $\lambda_i, \lambda_j \in\Lambda_k(\alpha)$. Importantly, the $\delta_k$ in Definition \ref{def:alpha-spectrum} are finite, so that they can be bounded by some $\delta$.} 

To obtain manifold filters that are stable to absolute perturbations of $\ccalL$, we also need these filters to be Lipschitz continuous as shown in Definition \ref{def:lipschitz}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[Lipschitz filter] \label{def:lipschitz}
A filter is $A_h$-Lispchitz if its frequency response is Lipschitz continuous with Lipschitz constant $A_h$, i.e,
\begin{equation}
    |\hhath(a)-\hhath(b)| \leq A_h |a-b|\text{ for all } a,b \in (0,\infty)\text{.}
\end{equation}
\end{definition}

Between the eigenvalue groups, the filters that we consider are assumed to be $A_h$-Lipschitz continuous. This means that, in regions of the spectrum where the $\Lambda_k(\alpha)$ are singletons, the filter can vary with slope at most $A_h$ as shown in Figure \ref{fig:alpha}. Note that we can always construct convolutional filters \eqref{eqn:operator-frequency} that are both Lipschitz continuous and $\alpha$-FDT.
%While the shape of $h(\lambda)$ in Definition \ref{def:alpha-filter} is constrained by the eigenvalue groups $\Lambda_k(\alpha)$, we can still find some $A_h$ to construct such a filter in the form of \eqref{eqn:operator-frequency}.

Under mild assumptions on the amplitude of the frequency response $\hat{h}$ (Assumption \ref{ass:filter_function}), it can be shown that Lipschitz continuous $\alpha$-FDT filters are stable to absolute perturbations of the LB operator. This result is stated in Theorem \ref{thm:stability_abs_filter}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% ASSUMPTION %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{assumption}[Non-amplifying filters] \label{ass:filter_function}
The filter frequency response $\hhath:\reals^+\rightarrow\reals$ is non-amplifying. I.e., for all $\lambda\in(0,\infty)$, $\hhath$ satisfies $|\hhath(\lambda)|\leq 1$.
\end{assumption}

Note that this assumption is rather reasonable, because the filter frequency response $\hhath(\lambda)$ can always be normalized.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% THEOREM %%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{theorem}[Manifold filter stability to absolute perturbations]\label{thm:stability_abs_filter}
Consider a manifold $\ccalM$ with LB operator $\ccalL$. Let $\bbh(\ccalL)$ be a $\alpha$-FDT manifold filter [cf. Definition \ref{def:alpha-filter}] and $A_h$-Lipschitz [cf. Definition \ref{def:lipschitz}]. 
Consider an absolute perturbation $\ccalL'=\ccalL + \bbA$ of the LB operator $\ccalL$ [cf. Definition \ref{def:abso-perturb}] where $\|\bbA\| = \epsilon < \alpha$. Then, under Assumption \ref{ass:filter_function} it holds that
 \begin{align}\label{eqn:stability_nn}
    \nonumber\|\bbh(\ccalL)f-& \bbh(\ccalL')f\|_{L^2(\ccalM)} \leq \\& \left(\frac{\pi N_s \epsilon}{\alpha-\epsilon}+A_h\epsilon+ 2(N-N_s)\delta\right) \|f\|_{L^2(\ccalM)},
 \end{align}
{where $N$ is the size of the $\alpha$-separated spectrum partition [cf. Definition \ref{def:alpha-spectrum}] and $N_s$ is the number of singletons.}
\end{theorem}
\begin{proof}
See Appendix \ref{app:stability_abs_filter}.
\end{proof}

Provided that $\epsilon \ll \alpha$, FDT filters are thus stable to absolute perturbations of the LB operator $\ccalL$. The stability bound
depends on (i) the continuity of the FDT filter as measured by the Lipschitz constant $A_h$ and (ii) its frequency difference threshold $\alpha$, which affects the bound directly as well as indirectly through the number of partitions $N$. Note that this bound consists of three terms. The first corresponds to
the difference between the eigenfunctions of $\ccalL$ and $\ccalL'$, which affects the stability bound by changing projection directions. The second stems from the distance between the original and perturbed eigenvalues. Finally, the third reflects the bounded fluctuation of the filter frequency response within the same eigenvalue group.

The bound in Theorem \ref{thm:stability_abs_filter} can be simplified by setting $\delta=\pi\epsilon/(2\alpha-2\epsilon)$ as in Corollary \ref{cor:stability_abs_filter}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% COROLLARY %%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{corollary}\label{cor:stability_abs_filter}
Setting $\delta=\pi\epsilon/(2\alpha-2\epsilon)$, under the same assumptions of Theorem \ref{thm:stability_abs_filter} it holds that
\begin{align}\label{eqn:stability_abs_filter_cor}
    \|\bbh(\ccalL)f-\bbh(\ccalL')f\|_{L^2(\ccalM)} \leq  \left(\frac{\pi N}{\alpha-\epsilon}+A_h\right)\epsilon \|f\|_{L^2(\ccalM)}.
 \end{align}
\end{corollary}

A particular case of Theorem \ref{thm:stability_abs_filter}, the simplified stability bound in Corollary \ref{cor:stability_abs_filter} is helpful to understand the effect of the filter spectrum on stability as well as of the size of the perturbation. 
In particular, from Corollary \ref{cor:stability_abs_filter} we can tell that the filter is more stable if the Lipschitz constant $A_h$ is small and the frequency difference threshold $\alpha$ is large.
On the other hand, small $A_h$ and large $\alpha$ mean that the filter is less discriminative. This reveals a stability-discriminability trade-off where discriminability should be understood as the ability to tell frequencies apart. In other words, we propose $\alpha$-FDT filter to maintain the stability by trying to discriminate only eigenvalue groups instead of every single eigenvalue. Importantly, this trade-off is not related to the magnitude of the frequencies that the filters amplify (as is the case in, e.g., \cite{gama2020stability}, \cite{ruiz2020graphon}).We will keep observing this trade-off throughout the stability analysis of both manifold filters and MNNs. More details about this characteristic will be discussed in Section \ref{subsec:discussion}.

% In the case of $A_h$, this happens because a smaller Lipschitz constant leads to a smoother filter function, i.e., the filter gives similar frequency responses to different eigenvalues. In the case of $\alpha$, a larger frequency difference threshold leads to a smaller number of partitions $\Lambda_k(\alpha)$, thus decreasing $N$. There are less partitions because eigenvalues that would be separated for small $\alpha$ end up being grouped when $\alpha$ is large. And while large $\alpha$ leads to a larger number of partitions with more than one eigenvalue, $N$ either stays the same or decreases, because the number of eigenvalues does not exceed the number of partitions [cf. Proposition \ref{prop:finite_num}]. 

% In conclusion, smaller values of $A_h$ and larger values of $\alpha$ improve filter stability, but worsen spectral discriminability.
%As filters give similar responses to all frequency components and separate the spectrum more sparsely  by treating more eigenvalues with little difference, the filter function becomes less discriminative. 

%\red{L: I don't think this paragraph is needed. You are already explaining why we need different filters to handle relative pertubations in the beginning of the next section.}
%Although Lipschitz $\alpha$-FDT filters are stable to absolute LB perturbations, they are not stable to perturbations {when the size of absolute perturbation is related to the norm of the original LB operator}. In the following, we show that to handle these relative LB perturbations we will need a different type of filter implementing a different type of spectrum separation. 

%\blue{Although the stability bound for absolute perturbations are sound and reasonable with the help of well-defined FDT filters. It fails to maintain the stability property when the size of absolute perturbation is related to the norm of the original LB operator, which is defined as relative perturbation in the following. This needs us to define another form of frequency separated filters to address the stability property under this perturbation setting, as discussed in the following.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% SUBSECTION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Stability of Manifold Filters to Relative Perturbations}
\label{subsec:filter-relative}

Relative perturbations of the LB operator are defined similarly as follows.

\begin{definition}[Relative perturbations] \label{def:rela-perturb}
Let $\ccalL$ be the LB operator of manifold $\ccalM$. A relative perturbation of $\ccalL$ is defined as
\begin{equation}\label{eqn:rela-perturb}
\ccalL'-\ccalL=\ccalE \ccalL,
\end{equation}
where the relative perturbation term $\ccalE \ccalL$ is self-adjoint.
\end{definition}

%Relative perturbations of the LB operator are additive perturbations, but where the perturbation operator is now multiplicative. 
%In particular, note that the relative perturbation in Definition \ref{def:rela-perturb} can be expressed as an absolute perturbation [cf. Definition \ref{def:abso-perturb}] where $\bbA = \bbE\ccalL$.
Like absolute perturbations, relative perturbations also perturb the eigenvalues and eigenfunctions of $\ccalL$. However, in the case of relative perturbations, the perturbations to the eigenvalues are proportional to their absolute values {[cf. Lemma 3 in the supplementary material]}. Relative perturbations thus require a different spectrum separation strategy to guarantee stability. With relative perturbations, larger eigenvalues are impacted with larger perturbation values, which can send eigenvalues originally $\alpha$-close to each other to different groups as Figure \ref{fig:gamma}. Therefore, we will need a different type of filter implementing a different type of spectrum separation. Our strategy is inspired by Proposition \ref{prop:finite_num_rela}, which is another variation of Weyl's law. 
%Proposition \ref{prop:finite_num_rela} which is also based on Weyl's law allows us to split the infinite-dimensional spectrum into a finite number of groups.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% PROPOSITION %%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{proposition} \label{prop:finite_num_rela}
Let $\ccalM$ be a $d$-dimensional compact embedded manifold in $\reals^N$ with LB operator $\ccalL$, and let $\{\lambda_k\}_{k=1}^\infty$ denote the eigenvalues of $\ccalL$. Let $C_1$ denote an arbitrary constant. For any $\gamma > 0$, there exists $N_2$ given by
\begin{equation}
    N_2=\lceil (C_1 (\gamma+1)^{d/2}-1)^{-1} \rceil
\end{equation}
such that, for all $k>N_2$, it holds that $$\lambda_{k+1}-\lambda_k\leq \gamma\lambda_k.$$
\end{proposition}
\begin{proof}
This is a direct consequence of Weyl's law \cite[Chapter~1]{arendt2009mathematical}.
\end{proof}

Hence, to enforce stability we need to separate the spectrum relatively to the ratio between neighboring eigenvalues. This partitioning is called the $\gamma$-separated spectrum and formalized in Definition \ref{def:frt-spectrum}. The $\gamma$-separated spectrum is achieved by the so-called Frequency Ratio Threshold (FRT) filters. We introduce them in Definition \ref{def:frt-filter}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{definition}[$\gamma$-separated spectrum.]\label{def:frt-spectrum}
The $\gamma$-separated spectrum of a LB operator $\ccalL$ is defined as the partition $\Lambda_1(\gamma)\cup\hdots \cup\Lambda_M(\gamma)$ such that all $\lambda_i\in\Lambda_k(\gamma)$ and $\lambda_j\in\Lambda_l(\gamma)$, $k\neq l$, satisfy
\begin{equation}
\label{eqn:frt-spectrum}
\left|\frac{\lambda_i}{\lambda_j}-1 \right|>\gamma.
\end{equation}
\end{definition}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[$\gamma$-FRT filter.]\label{def:frt-filter}
The $\gamma$-frequency ratio threshold ($\gamma$-FRT) filter is defined as a filter $\bbh(\ccalL)$ whose frequency response satisfies
\begin{equation}\label{eqn:frt-filter}
       |\hhath(\lambda_i)-\hhath(\lambda_j)|\leq \delta_k,\text{ for all } \lambda_i,\lambda_j\in\Lambda_k(\gamma)
\end{equation}
with $\delta_k\leq \delta$ for $k=1,2\hdots,M$.
\end{definition}

In the $\gamma$-separated spectrum, the sets $\Lambda_k(\gamma)$ are built based on eigenvalue distances \textit{relative} to the eigenvalues' magnitudes and weighted by the parameter $\gamma$. Eigenvalues $\lambda_j \in \Lambda_k(\gamma)$ and $\lambda_i \in \Lambda_l(\gamma)$ in different groups (i.e., $k \neq l$) are at least $\gamma\min(\lambda_i,\lambda_j)$ apart from each other. This means that, for $\lambda_i, \lambda_{i+1} \in \Lambda_k(\gamma)$, $\lambda_{i+1} - \lambda_i \leq \gamma \lambda_i$.

The $\gamma$-FRT filter achieves the spectrum separation in Definition \ref{def:frt-spectrum} by giving eigenvalues $\lambda_i, \lambda_j \in \Lambda_k(\gamma)$ very similar frequency responses differing by at most plus or minus $\delta_k < \delta$. Meanwhile, eigenvalues belonging to different sets $\Lambda_k(\gamma)$ and $\Lambda_l(\gamma)$, $k \neq l$, are treated independently, and their frequency response can vary a lot.

To make a manifold filter stable to relative perturbations of the LB operator, we need a further restriction on their continuity. Lipschitz continuity [cf. Definition \ref{def:lipschitz}] is not enough because in a Lipschitz filter the difference in frequency response for a perturbed eigenvalue grows with the eigenvalue magnitude, since the eigenvalue perturbation is relative. Therefore, we need our filters to be \textit{integral Lipschitz} continuous as is described in Definition \ref{def:int-lipschitz}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% DEFINITION %%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{definition}[Integral Lipschitz filter] \label{def:int-lipschitz}
A filter is integral Lipschitz continuous with constant $B_h$ if its frequency response is given by
\begin{equation}\label{eqn:filter_function}
    |\hhath(a)-\hhath(b)|\leq \frac{B_h |a-b| }{(a+b)/2} \text{ for all } a,b \in (0,\infty)\text{.}
\end{equation}
\end{definition}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% FIGURE %%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}
\centering
  \input{frequency_response_relative.txt}    
  \caption{Illustration of a $\gamma$-FRT filter. The $x$-axis stands for the spectrum with each sample representing an eigenvalue. The gray shaded area shows the grouping of the eigenvalues according to Definition \ref{def:frt-spectrum}. The red lines show a set of $\alpha$-FDT filters that can discriminate each eigenvalue group. }
\label{fig:gamma}
\end{figure}

Integral Lipschitz filters can be seen as Lipschitz filters with variable Lipschitz constant, which decreases with $\lambda$. E.g., on the interval $(a,b)$, the filter in Definition \ref{def:int-lipschitz} behaves as a Lipschitz filter with Lipschitz constant $2B_h/(a+b)$. When $a$ and $b$ are close, this condition can be approximated by $|a\hat{h}'(a)|\leq B_h$. This implies that the filter function flattens for high-frequency eigenvalues as shown in Figure \ref{fig:gamma}.

Under Assumption \ref{ass:filter_function}, integral Lipschitz $\gamma$-FRT filters are stable to relative perturbations as stated in Theorem \ref{thm:stability_rela_filter}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% THEOREM %%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{theorem}[Manifold filter stability to relative perturbations]\label{thm:stability_rela_filter}
Consider a manifold $\ccalM$ with LB operator $\ccalL$. Let $\bbh(\ccalL)$ be a $\gamma$-FRT filter with $\delta=\pi\epsilon/(2\gamma-2\epsilon+2\gamma\epsilon)$ [cf. Definition \ref{def:frt-filter}] and $B_h$-integral Lipschitz [cf. Definition \ref{def:int-lipschitz}]. 
Consider a relative perturbation $\ccalL'=\ccalL + \bbE\ccalL$ of the LB operator $\ccalL$ [cf. Definition \ref{def:rela-perturb}] where $\|\bbE\| = \epsilon < \gamma$. 
Then, under Assumption \ref{ass:filter_function} it holds that
 \begin{align}\label{eqn:stability_rela_filter}
 \|\bbh(\ccalL)f-&\bbh(\ccalL')f\|_{L^2(\ccalM)}   \leq  \left(\frac{\pi M\epsilon}{\gamma-\epsilon+\gamma\epsilon}+ \frac{2{B_h}\epsilon}{2-\epsilon} \right) \|f\|_{L^2(\ccalM)} 
 \end{align}
where $M$ is the size of the $\gamma$-separated spectrum partition [cf. Definition \ref{def:frt-spectrum}].
\end{theorem}
\begin{proof}
See Section \ref{app:stability_rela_filter} in supplementary material.
\end{proof}

When $\epsilon$ is sufficiently small ($\epsilon \ll \min(\gamma,2)$, which is typically the case with deformations such as the one in Theorem \ref{thm:perturb}), the denominators on the right hand side of \eqref{eqn:stability_rela_filter} are approximately equal to $\gamma$ and $2$ respectively. Hence, $\gamma$-FRT integral Lipschitz filters are stable to relative perturbations of the LB operator.
Besides appearing in the bound in Theorem \ref{thm:stability_rela_filter}), the frequency ratio threshold $\gamma$ also affects stability indirectly through the partition size $M$. With a larger $\gamma$, fewer eigenvalues will be in singleton sets, thus decreasing $M$ and improving stability. A smaller integral Lipschitz constant $B_h$ also increases stability. However, small $B_h$ and large $\gamma$ make for smoother filters which in turn lead to a less discriminative manifold filter. Therefore, integral Lipschitz $\gamma$-FRT filters also exhibit a trade-off between discriminality and stability. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% REMARK %%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{remark}
\normalfont
\label{rem:filters}
By comparing the illustrations of $\alpha$-FDT filter (Definition \ref{def:alpha-filter}) and $\gamma$-FRT filter (Definition \ref{def:frt-filter}) in Figure \ref{fig:alpha} and Figure \ref{fig:gamma}, we see that in practice these filters have a similar frequency behavior because, due to Weyl's law [cf. Proposition \ref{prop:finite_num} and \ref{prop:finite_num_rela}], high frequency components will eventually be grouped in the same group and thus share similar frequency responses. Therefore, the main difference between these filters is their effects on the low-frequency components. In the low frequency spectrum, the eigengaps $\lambda_{i+1}-\lambda_i$ may be smaller than the difference threshold $\alpha$, but larger than the relative ratio threshold $\gamma \lambda_i$ due to $\lambda_i$ being small. However, for appropriate values of $\gamma$ a filter may be both FDT and FRT. This will be shown in Section \ref{sec:stability_nn}.
\end{remark}



